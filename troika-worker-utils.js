/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/troika-worker-utils@0.45.0/dist/troika-worker-utils.esm.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var e="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};"function"==typeof e.setTimeout&&setTimeout,"function"==typeof e.clearTimeout&&clearTimeout;function n(e,n){this.fun=e,this.array=n}n.prototype.run=function(){this.fun.apply(null,this.array)};var r=e.performance||{};r.now||r.mozNow||r.msNow||r.oNow||r.webkitNow;new Date;function t(){var e,n=0,r=[],o=0,a=0;var i=v((function(e){a||c(1,e)})),u=v((function(e){a||c(-1,e)}));function c(r,t){a++;var o=0;try{t===g&&p();var i=r>0&&d(t);i?i.call(t,v((function(e){o++,c(1,e)})),v((function(e){o++,c(-1,e)}))):(n=r,e=t,s())}catch(e){n||o||c(-1,e)}}function s(){o||(setTimeout(l,0),o=1)}function l(){var e=r;o=0,r=[],e.forEach(f)}function f(e){e()}function d(e){var n=e&&(w(e)||"object"==typeof e)&&e.then;return w(n)&&n}function v(e){var n=0;return function(){for(var r=[],t=arguments.length;t--;)r[t]=arguments[t];n++||e.apply(this,r)}}function p(){throw new TypeError("Chaining cycle detected")}var w=function(e){return"function"==typeof e},g={then:function(o,a){var i=t();return r.push((function(){var r=n>0?o:a;if(w(r))try{var t=r(e);t===i&&p();var u=d(t);u?u.call(t,i.resolve,i.reject):i.resolve(t)}catch(e){i.reject(e)}else i[n>0?"resolve":"reject"](e)})),n&&s(),i},resolve:i,reject:u};return g}function o(){var e,n,r=new Promise((function(r,t){e=r,n=t}));return{then:r.then.bind(r),resolve:e,reject:n}}t.all=o.all=function(e){var n=0,r=[],t=a();return 0===e.length?t.resolve([]):e.forEach((function(o,i){var u=a();u.resolve(o),u.then((function(o){n++,r[i]=o,n===e.length&&t.resolve(r)}),t.reject)})),t};var a="function"==typeof Promise?o:t;function i(){var e=Object.create(null);function n(t,o){var a=t.id,i=t.name,u=t.dependencies;void 0===u&&(u=[]);var c=t.init;void 0===c&&(c=function(){});var s=t.getTransferables;if(void 0===s&&(s=null),!e[a])try{u=u.map((function(r){return r&&r.isWorkerModule&&(n(r,(function(e){if(e instanceof Error)throw e})),r=e[r.id].value),r})),c=r("<"+i+">.init",c),s&&(s=r("<"+i+">.getTransferables",s));var l=null;"function"==typeof c?l=c.apply(void 0,u):console.error("worker module init function failed to rehydrate"),e[a]={id:a,value:l,getTransferables:s},o(l)}catch(e){e&&e.noLog||console.error(e),o(e)}}function r(e,n){var r=void 0;self.troikaDefine=function(e){return r=e};var t=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+n+"\n)"],{type:"application/javascript"}));try{importScripts(t)}catch(e){console.error(e)}return URL.revokeObjectURL(t),delete self.troikaDefine,r}self.addEventListener("message",(function(r){var t=r.data,o=t.messageId,a=t.action,i=t.data;try{"registerModule"===a&&n(i,(function(e){e instanceof Error?postMessage({messageId:o,success:!1,error:e.message}):postMessage({messageId:o,success:!0,result:{isCallable:"function"==typeof e}})})),"callModule"===a&&function(n,r){var t,o=n.id,a=n.args;e[o]&&"function"==typeof e[o].value||r(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var i=(t=e[o]).value.apply(t,a);i&&"function"==typeof i.then?i.then(u,(function(e){return r(e instanceof Error?e:new Error(""+e))})):u(i)}catch(e){r(e)}function u(n){try{var t=e[o].getTransferables&&e[o].getTransferables(n);t&&Array.isArray(t)&&t.length||(t=void 0),r(n,t)}catch(e){console.error(e),r(e)}}}(i,(function(e,n){e instanceof Error?postMessage({messageId:o,success:!1,error:e.message}):postMessage({messageId:o,success:!0,result:e},n||void 0)}))}catch(e){postMessage({messageId:o,success:!1,error:e.stack})}}))}var u=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+e.message+"]")}return u=function(){return e},e},c=0,s=0,l=!1,f=Object.create(null),d=Object.create(null),v=Object.create(null);function p(e){if(!(e&&"function"==typeof e.init||l))throw new Error("requires `options.init` function");var n=e.dependencies,r=e.init,t=e.getTransferables,o=e.workerId;if(!u())return function(e){var n=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return n._getInitResult().then((function(n){if("function"==typeof n)return n.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return n._getInitResult=function(){var r=e.dependencies,t=e.init;r=Array.isArray(r)?r.map((function(e){return e&&e._getInitResult?e._getInitResult():e})):[];var o=a.all(r).then((function(e){return t.apply(null,e)}));return n._getInitResult=function(){return o},o},n}(e);null==o&&(o="#default");var i="workerModule"+ ++c,s=e.name||i,f=null;function v(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(!f){f=h(o,"registerModule",v.workerModuleData);var r=function(){f=null,d[o].delete(r)};(d[o]||(d[o]=new Set)).add(r)}return f.then((function(n){if(n.isCallable)return h(o,"callModule",{id:i,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return n=n&&n.map((function(e){return"function"!=typeof e||e.workerModuleData||(l=!0,e=p({workerId:o,name:"<"+s+"> function dependency: "+e.name,init:"function(){return (\n"+g(e)+"\n)}"}),l=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e})),v.workerModuleData={isWorkerModule:!0,id:i,name:s,dependencies:n,init:g(r),getTransferables:t&&g(t)},v}function w(e){d[e]&&d[e].forEach((function(e){e()})),f[e]&&(f[e].terminate(),delete f[e])}function g(e){var n=e.toString();return!/^function/.test(n)&&/^\w+\s*\(/.test(n)&&(n="function "+n),n}function h(e,n,r){var t=a(),o=++s;return v[o]=function(e){e.success?t.resolve(e.result):t.reject(new Error("Error in worker "+n+" call: "+e.error))},function(e){var n=f[e];if(!n){var r=g(i);(n=f[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var n=e.data,r=n.messageId,t=v[r];if(!t)throw new Error("WorkerModule response with empty or unknown messageId");delete v[r],t(n)}}return n}(e).postMessage({messageId:o,action:n,data:r}),t}var y=p({name:"Thenable",dependencies:[a],init:function(e){return e}});export{a as Thenable,y as ThenableWorkerModule,p as defineWorkerModule,g as stringifyFunction,w as terminateWorker};export default null;
//# sourceMappingURL=/sm/b85b7bc0bff2b4e755d83c5a3aab000cb6cca43f1cbf021214e612087419d4da.map